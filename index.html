
    <script>
        // Backend API URL
        const API_URL = 'https://ds-qr.onrender.com';
        
        // Get event ID from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const eventId = urlParams.get('event');
        
        // Show notification
                
        // Load event media
        <script>
    // Backend API URL
    const API_URL = 'https://ds-qr.onrender.com';
    
    // Get event ID from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const eventId = urlParams.get('event');
    
    // ADD THIS NEW FUNCTION FOR HANDLING TELEGRAM MEDIA
    async function handleTelegramMedia(url, type) {
      try {
        // Test if the Telegram CDN link works
        const testResponse = await fetch(url, { method: 'HEAD' });
        
        if (testResponse.ok) {
          return url; // Link works, use it directly
        }
      } catch (error) {
        console.log('Telegram CDN link failed, using proxy');
      }
      
      // If Telegram CDN fails, use a proxy through your backend
      return `${API_URL}/proxy?url=${encodeURIComponent(url)}&type=${type}`;
    }
    
    // Show notification
    function showNotification(message, isError = false) {
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notification-text');
        
        if (isError) {
            notification.style.background = 'linear-gradient(135deg, #ff4b4b, #ff7b7b)';
        } else {
            notification.style.background = 'linear-gradient(135deg, #7e4fd3, #5a6bd8)';
        }
        
        notificationText.textContent = message;
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }
    
    // Open modal with media
    function openModal(mediaUrl, type) {
        const modal = document.getElementById('modal');
        const modalContent = document.getElementById('modal-content');
        
        if (type === 'photo') {
            modalContent.innerHTML = `<img src="${mediaUrl}" alt="Event photo">`;
        } else {
            modalContent.innerHTML = `
                <video controls autoplay>
                    <source src="${mediaUrl}" type="video/mp4">
                    Your browser does not support videos.
                </video>
            `;
        }
        
        modal.classList.add('show');
        document.body.style.overflow = 'hidden';
    }
    
    // Close modal
    function closeModal() {
        const modal = document.getElementById('modal');
        const modalContent = document.getElementById('modal-content');
        
        modal.classList.remove('show');
        document.body.style.overflow = 'auto';
        
        // Stop video playback
        const video = modalContent.querySelector('video');
        if (video) {
            video.pause();
            video.currentTime = 0;
        }
        
        setTimeout(() => {
            modalContent.innerHTML = '';
        }, 300);
    }
    
    // Close modal on ESC key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            closeModal();
        }
    });
    
    // Close modal on background click
    document.getElementById('modal').addEventListener('click', (e) => {
        if (e.target === document.getElementById('modal')) {
            closeModal();
        }
    });
    
    // Load event media - UPDATED WITH TELEGRAM MEDIA HANDLING
    async function loadEventMedia() {
        const gallery = document.getElementById('gallery');
        
        if (!eventId) {
            gallery.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-images"></i>
                    <h2>No Event Selected</h2>
                    <p>Please use a valid event link to view media</p>
                </div>
            `;
            return;
        }
        
        try {
            gallery.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading beautiful memories...</p>
                </div>
            `;
            
            const response = await fetch(`${API_URL}/api/event/${eventId}`);
            
            if (!response.ok) {
                throw new Error('Event not found');
            }
            
            const eventData = await response.json();
            
            if (!eventData.media || eventData.media.length === 0) {
                gallery.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-camera"></i>
                        <h2>No Media Yet</h2>
                        <p>Photos and videos will appear here once uploaded</p>
                    </div>
                `;
                return;
            }
            
            // Clear loading state
            gallery.innerHTML = '';
            
            // Add media items with staggered animation - UPDATED WITH WORKING URLS
            for (const [index, item] of eventData.media.entries()) {
                const mediaElement = document.createElement('div');
                mediaElement.className = 'media-item';
                mediaElement.style.animationDelay = `${index * 0.1}s`;
                
                // GET WORKING URL FOR EACH MEDIA ITEM
                const workingUrl = await handleTelegramMedia(item.file_path, item.type);
                
                if (item.type === 'photo') {
                    mediaElement.innerHTML = `
                        <img src="${workingUrl}" alt="Event photo" loading="lazy">
                        <div class="media-type">Photo</div>
                    `;
                } else {
                    mediaElement.innerHTML = `
                        <video poster="data:image/gif,AAAA" preload="none">
                            <source src="${workingUrl}" type="video/mp4">
                        </video>
                        <div class="media-type">Video</div>
                    `;
                }
                
                mediaElement.addEventListener('click', () => {
                    openModal(workingUrl, item.type);
                });
                
                gallery.appendChild(mediaElement);
            }
            
            // Lazy load images and videos
            const lazyMedia = gallery.querySelectorAll('img[loading="lazy"], video');
            lazyMedia.forEach(media => {
                if (media.tagName === 'IMG') {
                    media.addEventListener('load', () => {
                        media.style.opacity = '1';
                    });
                }
            });
            
        } catch (error) {
            console.error('Error loading media:', error);
            gallery.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h2>Unable to Load Media</h2>
                    <p>Please check the event link and try again</p>
                </div>
            `;
            showNotification('Error loading media: ' + error.message, true);
        }
    }
    
    // Auto-refresh media every 30 seconds
    setInterval(loadEventMedia, 30000);
    
    // Initialize on load
    document.addEventListener('DOMContentLoaded', () => {
        loadEventMedia();
        
        // Check for new media every 30 seconds
        setInterval(loadEventMedia, 30000);
    });
</script>
